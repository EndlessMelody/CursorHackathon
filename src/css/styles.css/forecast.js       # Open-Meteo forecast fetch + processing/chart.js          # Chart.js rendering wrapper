// src/js/forecast.js
async function fetchForecast(lat, lon, model) {
    const params = new URLSearchParams({
        latitude: lat,
        longitude: lon,
        hourly: 'temperature_2m,relativehumidity_2m,windspeed_10m,precipitation_probability,precipitation',
        timezone: 'auto',
        forecast_days: 3
    });
    if (model) params.set('forecast_model', model);

    const response = await fetch(`https://api.open-meteo.com/v1/forecast?${params.toString()}`);
    if (!response.ok) throw new Error('Error fetching forecast');
    return await response.json();
}

function processForecastData(data) {
    const times = data.hourly.time.map(t => new Date(t));
    const temps = data.hourly.temperature_2m;
    const hums = data.hourly.relativehumidity_2m;
    const winds = data.hourly.windspeed_10m;
    const rainp = data.hourly.precipitation_probability;

    return { times, temps, hums, winds, rainp };
}

// Export functions for use in other modules
export { fetchForecast, processForecastData };

// src/js/chart.js
import { Chart } from 'chart.js';

let chart = null;

function renderChart(labels, temps, rains) {
    const ctx = document.getElementById('chart').getContext('2d');
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels,
            datasets: [
                {
                    label: 'Temp (°C)',
                    data: temps,
                    yAxisID: 'y',
                    tension: 0.3,
                    pointRadius: 2
                },
                {
                    label: 'Rain (%)',
                    data: rains,
                    yAxisID: 'y1',
                    tension: 0.3,
                    pointRadius: 2
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    type: 'linear',
                    position: 'left',
                    title: {
                        display: true,
                        text: '°C'
                    }
                },
                y1: {
                    type: 'linear',
                    position: 'right',
                    title: {
                        display: true,
                        text: '%'
                    },
                    grid: {
                        drawOnChartArea: false
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'top'
                }
            }
        }
    });
}

// Export renderChart function for use in other modules
export { renderChart };